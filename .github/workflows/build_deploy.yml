name: Deploy sample app

on:
  push:
    branches:
<<<<<<< HEAD
     - main


jobs:

  deploy:
    name: Build image
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v2

    - name: Check out code
      uses: actions/checkout@v2
      with:
        path: ./hello-task

    - name: Install kubectl
      uses: azure/setup-kubectl@v1
      with:
        version: 'v1.21.3'
      id: install


    - name: Login to Docker Hub
      uses: docker/login-action@v2
      with:
        username:  ${{ secrets.DOCKERHUB_USERNAME }}
        password:  ${{ secrets.DOCKERHUB_TOKEN }}



    - name: Build, tag, and push image to container registry
      run: |
        docker build -t php-image:test apache:test .
        docker push apache:test

#    - name: Update kube config
#      run: aws eks update-kubeconfig --name simple-bank --region eu-west-1
#
#    - name: Deploy image to Amazon EKS
#      run: |
#        kubectl apply -f eks/aws-auth.yaml
#        kubectl apply -f eks/deployment.yaml
#        kubectl apply -f eks/service.yaml
#        kubectl apply -f eks/issuer.yaml
#        kubectl apply -f eks/ingress.yaml
#
